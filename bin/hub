#!/bin/bash
function contains() {
	local element
	for element in "${@:2}"
	do
		if [[ "$element" == "$1" ]]
		then
			return 0
		fi
	done
	return 1
}

if contains "$1" 'exec' 'pull-request' 'fork' 'create' 'release' 'issue'
then
	credentials="$(pass github)"
	cat <<-EOF > "$HOME/.config/hub"
	github.com:
	- user: $(echo "$credentials" | awk '/Username/ {print $2}')
	  oauth_token: $(echo "$credentials" | awk 'NR == 2')
	  protocol: https
	EOF
fi

if [[ $1 = 'exec' ]]
then
	"$2" "${@:3}"
else
	/usr/bin/hub "$@"
fi

code=$?
echo '' > "$HOME/.config/hub"
exit $code
